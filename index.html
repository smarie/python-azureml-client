


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>azmlclient</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.a676eddb.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azmlclient" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="." title="azmlclient" class="md-header-nav__button md-logo" aria-label="azmlclient">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            azmlclient
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Home
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/smarie/python-azureml-client/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="azmlclient" class="md-nav__button md-logo" aria-label="azmlclient">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    azmlclient
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/smarie/python-azureml-client/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Home
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="." title="Home" class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-low-level-api" class="md-nav__link">
    1. Low level API
  </a>
  
    <nav class="md-nav" aria-label="1. Low level API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-examples" class="md-nav__link">
    First examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formatting-options" class="md-nav__link">
    Formatting options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-and-proxies" class="md-nav__link">
    Debug and proxies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-usage" class="md-nav__link">
    Advanced usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-providing-high-level-apis" class="md-nav__link">
    2. Providing high-level APIs
  </a>
  
    <nav class="md-nav" aria-label="2. Providing high-level APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-main-client-class" class="md-nav__link">
    Creating the main client class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-it" class="md-nav__link">
    Using it
  </a>
  
    <nav class="md-nav" aria-label="Using it">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#templating" class="md-nav__link">
    Templating
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternate-call-modes-local-batch" class="md-nav__link">
    Alternate call modes: local, batch..
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-payload-conversion-goodies" class="md-nav__link">
    3. Payload conversion goodies
  </a>
  
    <nav class="md-nav" aria-label="3. Payload conversion goodies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-json-to-python" class="md-nav__link">
    From json to python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-python-to-json" class="md-nav__link">
    From python to json
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features" class="md-nav__link">
    Main features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See Also
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    Others
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-low-level-api" class="md-nav__link">
    1. Low level API
  </a>
  
    <nav class="md-nav" aria-label="1. Low level API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-examples" class="md-nav__link">
    First examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formatting-options" class="md-nav__link">
    Formatting options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-and-proxies" class="md-nav__link">
    Debug and proxies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-usage" class="md-nav__link">
    Advanced usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-providing-high-level-apis" class="md-nav__link">
    2. Providing high-level APIs
  </a>
  
    <nav class="md-nav" aria-label="2. Providing high-level APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-main-client-class" class="md-nav__link">
    Creating the main client class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-it" class="md-nav__link">
    Using it
  </a>
  
    <nav class="md-nav" aria-label="Using it">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#templating" class="md-nav__link">
    Templating
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternate-call-modes-local-batch" class="md-nav__link">
    Alternate call modes: local, batch..
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-payload-conversion-goodies" class="md-nav__link">
    3. Payload conversion goodies
  </a>
  
    <nav class="md-nav" aria-label="3. Payload conversion goodies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-json-to-python" class="md-nav__link">
    From json to python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-python-to-json" class="md-nav__link">
    From python to json
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features" class="md-nav__link">
    Main features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See Also
  </a>
  
    <nav class="md-nav" aria-label="See Also">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#others" class="md-nav__link">
    Others
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/smarie/python-azureml-client/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="azmlclient">azmlclient<a class="headerlink" href="#azmlclient" title="Permanent link">&para;</a></h1>
<p><em>An </em><strong>unofficial</strong><em> generic client stack for AzureML web services, working with both python 2 and 3.</em></p>
<p><a href="https://pypi.python.org/pypi/azmlclient/"><img alt="Python versions" src="https://img.shields.io/pypi/pyversions/azmlclient.svg" /></a> <a href="https://travis-ci.org/smarie/python-azureml-client"><img alt="Build Status" src="https://travis-ci.org/smarie/python-azureml-client.svg?branch=master" /></a> <a href="https://smarie.github.io/python-azureml-client/junit/report.html"><img alt="Tests Status" src="https://smarie.github.io/python-azureml-client/junit/junit-badge.svg?dummy=8484744" /></a> <a href="https://codecov.io/gh/smarie/python-azureml-client"><img alt="codecov" src="https://codecov.io/gh/smarie/python-azureml-client/branch/master/graph/badge.svg" /></a></p>
<p><a href="https://smarie.github.io/python-azureml-client/"><img alt="Documentation" src="https://img.shields.io/badge/doc-latest-blue.svg" /></a> <a href="https://pypi.python.org/pypi/azmlclient/"><img alt="PyPI" src="https://img.shields.io/pypi/v/azmlclient.svg" /></a> <a href="https://pepy.tech/project/azmlclient"><img alt="Downloads" src="https://pepy.tech/badge/azmlclient" /></a> <a href="https://pepy.tech/project/azmlclient"><img alt="Downloads per week" src="https://pepy.tech/badge/azmlclient/week" /></a> <a href="https://github.com/smarie/python-azureml-client/stargazers"><img alt="GitHub stars" src="https://img.shields.io/github/stars/smarie/python-azureml-client.svg" /></a></p>
<div class="admonition success">
<p class="admonition-title">New <code>AzureMLClient</code> base class to create high-level clients is here, <a href="#2-providing-high-level-apis">check it out</a></p>
</div>
<p><code>azmlclient</code> helps you consume web services deployed on the AzureML platform easily. It provides you with a <a href="#1-low-level-api">low-level API</a> to call web services in request-response or batch mode. It also offers optional tools if you wish to provide <a href="#2-providing-high-level-apis">high-level applicative APIs</a> on top of these web services. </p>
<p>As opposed to <a href="https://github.com/Azure/Azure-MachineLearning-ClientLibrary-Python#services-usage">AzureML client library</a>, </p>
<ul>
<li>this library is <em>much simpler</em> and is only focused on <em>consuming</em> web services. </li>
<li>It is compliant with all services deployed from AzureML experiments (using the AzureML studio UI), and should also work with python and R "dataframe" web services (not checked though). </li>
<li>It does not require your AzureML workspace id and API key, only the deployed services' URL and API key.</li>
</ul>
<p>You may use it for example </p>
<ul>
<li>to show to your customers how to consume your AzureML cloud services.</li>
<li>to make simple 'edge' devices consume your AzureML cloud services (if they support python :) ).</li>
</ul>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>&gt; pip install azmlclient
</code></pre></div>


<h2 id="1-low-level-api">1. Low level API<a class="headerlink" href="#1-low-level-api" title="Permanent link">&para;</a></h2>
<p>This API is the python equivalent of the "execute" generic AzureML operation. It supports both request-response and batch mode, as well as swagger and non-swagger format.</p>
<h3 id="first-examples">First examples<a class="headerlink" href="#first-examples" title="Permanent link">&para;</a></h3>
<p>First create variables holding the endpoint information provided by AzureML</p>
<div class="codehilite"><pre><span></span><code><span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://&lt;geo&gt;.services.azureml.net/workspaces/&lt;wId&gt;/services/&lt;sId&gt;&#39;</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="s1">&#39;&lt;apiKey&gt;&#39;</span>
</code></pre></div>


<p>Then create </p>
<ul>
<li>the inputs - a dictionary containing all you inputs as <code>pandas.DataFrame</code> objects</li>
<li>the parameters - a dictionary</li>
<li>and optionally define a list of expected output names</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trainDataset&quot;</span><span class="p">:</span> <span class="n">training_df</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">:</span> <span class="n">input2_df</span><span class="p">}</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;param1&quot;</span><span class="p">:</span> <span class="s2">&quot;val1&quot;</span><span class="p">,</span> <span class="s2">&quot;param2&quot;</span><span class="p">:</span> <span class="s2">&quot;val2&quot;</span><span class="p">}</span>
<span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;my_out1&quot;</span><span class="p">,</span><span class="s2">&quot;my_out2&quot;</span><span class="p">]</span>
</code></pre></div>


<p>Finally call in Request-Response mode:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">azmlclient</span> <span class="kn">import</span> <span class="n">execute_rr</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">execute_rr</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> 
                     <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span><span class="p">)</span>
</code></pre></div>


<p>Or in Batch mode. In this case you also need to configure the Blob storage to be used:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">azmlclient</span> <span class="kn">import</span> <span class="n">execute_bes</span>

<span class="c1"># Define the blob storage to use for storing inputs and outputs</span>
<span class="n">blob_account</span> <span class="o">=</span> <span class="s1">&#39;&lt;account_id&gt;&#39;</span>       <span class="c1"># &#39;myblobs&#39;</span>
<span class="n">blob_apikey</span> <span class="o">=</span> <span class="s1">&#39;&lt;api_key&gt;&#39;</span>           <span class="c1"># &#39;mi3Qxcd5rwuM9r5k7h2ipXNww2T0Bw==&#39;</span>
<span class="n">blob_container</span> <span class="o">=</span> <span class="s1">&#39;&lt;container&gt;&#39;</span>      <span class="c1"># &#39;rootcontainer&#39;</span>
<span class="n">blob_path_prefix</span> <span class="o">=</span> <span class="s1">&#39;&lt;path_prefix&gt;&#39;</span>  <span class="c1"># &#39;folder/path&#39;</span>

<span class="c1"># Perform the call (polling is done by default every 5s until job end)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">execute_bes</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span>
                      <span class="n">blob_account</span><span class="p">,</span> <span class="n">blob_apikey</span><span class="p">,</span> <span class="n">blob_container</span><span class="p">,</span> 
                      <span class="n">blob_path_prefix</span><span class="o">=</span><span class="n">blob_path_prefix</span><span class="p">,</span>
                      <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span><span class="p">)</span>
</code></pre></div>


<h3 id="formatting-options">Formatting options<a class="headerlink" href="#formatting-options" title="Permanent link">&para;</a></h3>
<p><code>execute_bes</code> provides several options to control how dataframes are converted to json in the request payloads:</p>
<ul>
<li><code>swagger_format</code> is a boolean (default <code>False</code>) enabling the more verbose "swagger" (= json objects) format</li>
<li><code>replace_NaN_with</code> and <code>replace_NaT_with</code> control how <code>NaN</code> and <code>NaT</code> are converted</li>
</ul>
<h3 id="debug-and-proxies">Debug and proxies<a class="headerlink" href="#debug-and-proxies" title="Permanent link">&para;</a></h3>
<p>Users may wish to create a requests session object using the helper method provided, in order to override environment variable settings for HTTP requests. For example to use <a href="https://www.telerik.com/fiddler"><code>Fiddler</code></a> as a proxy to debug the web service calls: </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">azmlclient</span> <span class="kn">import</span> <span class="n">create_session_for_proxy</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">create_session_for_proxy</span><span class="p">(</span><span class="n">http_proxyhost</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> 
                                   <span class="n">http_proxyport</span><span class="o">=</span><span class="mi">8888</span><span class="p">,</span> 
                                   <span class="n">use_http_for_https_proxy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">ssl_verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>


<p>Then you may use that object in the <code>requests_session</code> parameter of the methods: </p>
<div class="codehilite"><pre><span></span><code><span class="n">outputsRR</span> <span class="o">=</span> <span class="n">execute_rr</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">requests_session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
<span class="n">outputsB</span> <span class="o">=</span> <span class="n">execute_bes</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">requests_session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</code></pre></div>


<p>Note that the session object will be passed to the underlying azure blob storage client to ensure consistency.</p>
<h3 id="advanced-usage">Advanced usage<a class="headerlink" href="#advanced-usage" title="Permanent link">&para;</a></h3>
<p>Advanced users may with to create <code>BatchClient</code> or <code>RequestResponseClient</code> classes to better control what's happening.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">azmlclient</span> <span class="kn">import</span> <span class="n">RequestResponseClient</span>

<span class="c1"># 0- Create the client</span>
<span class="n">rr_client</span> <span class="o">=</span> <span class="n">RequestResponseClient</span><span class="p">(</span><span class="n">requests_session</span><span class="o">=</span><span class="n">requests_session</span><span class="p">)</span>

<span class="c1"># 1- Create the query body</span>
<span class="n">request_body</span> <span class="o">=</span> <span class="n">rr_client</span><span class="o">.</span><span class="n">create_request_body</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="c1"># 2- Execute the query and receive the response body</span>
<span class="n">response_body</span> <span class="o">=</span> <span class="n">rr_client</span><span class="o">.</span><span class="n">execute_rr</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">request_body</span><span class="p">)</span>
<span class="c1"># 3- parse the response body into a dictionary of dataframes</span>
<span class="n">result_dfs</span> <span class="o">=</span> <span class="n">rr_client</span><span class="o">.</span><span class="n">read_response_json_body</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="n">output_names</span><span class="p">)</span>
</code></pre></div>


<h2 id="2-providing-high-level-apis">2. Providing high-level APIs<a class="headerlink" href="#2-providing-high-level-apis" title="Permanent link">&para;</a></h2>
<p>Even though the above API is enough to consume your AzureML web services, it is still very low-level: </p>
<ul>
<li>the services are not mapped to python methods with friendly names</li>
<li>their inputs, outputs and parameters have to be created by hand from python structures</li>
<li>changing the call mode between request-response and batch requires you to change your code</li>
<li>there is no easy way to switch between remote and local call, for example for hybrid implementations (computationally intensive operations in the cloud, computationally cheap operations executed locally)</li>
</ul>
<p>For all these reasons, <code>azmlclient</code> offers tools to help you provide higher-level APIs. </p>
<h3 id="creating-the-main-client-class">Creating the main client class<a class="headerlink" href="#creating-the-main-client-class" title="Permanent link">&para;</a></h3>
<p>Let's imagine that we have <strong>two AzureML services</strong> deployed: one for <em>adding dataframe columns</em> and another for <em>subtracting them</em>. We wish to provide our users with a more pythonic way to call them than the <a href="#1-low-level-api">low-level api</a> that we saw previously.</p>
<p>A nice way to do this is to create a <strong>"client class"</strong>, that will hide away the AzureML specific syntax. We will name our class <code>MathsProvider</code>, it will offer one pythonic method mapped on each AzureML service: <code>add_columns(a_name, b_name, df)</code> and <code>subtract_columns(a_name, b_name, df)</code> respectively.</p>
<p>It is extremely easy to create such a class, by inheriting from <code>AzureMLClient</code>. This helper base class provide a bunch of mechanisms to automate both configuration and support for alternate call modes (local, request-response, batch) as we'll see below.</p>
<p>For each service that we want to offer, we create a method. That method should</p>
<ul>
<li>be decorated with <code>@azureml_service</code>,</li>
<li>transform the received arguments (python objects) into azureml inputs and parameters dictionaries, in the same format that presented previously in the <a href="#1-low-level-api">low-level api</a>,</li>
<li>use the <code>self.call_azureml(...)</code> helper function to perform the AzureML call. Note that this helper function handles the call mode (request response or batch) for you as we'll see below.</li>
<li>unpack the various results and create the appropriate outputs (python objects) from them.</li>
</ul>
<p>For example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">azmlclient</span> <span class="kn">import</span> <span class="n">AzureMLClient</span><span class="p">,</span> <span class="n">azureml_service</span>

<span class="k">class</span> <span class="nc">MathsProvider</span><span class="p">(</span><span class="n">AzureMLClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A client for the `add_columns` and `subtract_columns` AzureML web services</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@azureml_service</span>
    <span class="k">def</span> <span class="nf">add_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_name</span><span class="p">,</span> <span class="n">b_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Offers a pythonic API around the `add_columns` azureML service</span>

<span class="sd">        :param a_name: name of the first column to add (a string)</span>
<span class="sd">        :param b_name: name of the second column to add (a string)</span>
<span class="sd">        :param df: the input dataframe, that should at least contain the 2 columns selected</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># (1) create the web service inputs and parameters from provided data.</span>
        <span class="n">ws_inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">}</span>
        <span class="n">ws_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a_name&#39;</span><span class="p">:</span> <span class="n">a_name</span><span class="p">,</span> <span class="s1">&#39;b_name&#39;</span><span class="p">:</span> <span class="n">b_name</span><span class="p">}</span>

        <span class="c1"># (2) call the azureml web service</span>
        <span class="n">result_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_azureml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_columns</span><span class="p">,</span>
                                       <span class="n">ws_inputs</span><span class="o">=</span><span class="n">ws_inputs</span><span class="p">,</span> 
                                       <span class="n">ws_params</span><span class="o">=</span><span class="n">ws_params</span><span class="p">,</span>
                                       <span class="n">ws_output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>  <span class="c1"># optional</span>
                                       <span class="p">)</span>

        <span class="c1"># (3) unpack the results</span>
        <span class="k">return</span> <span class="n">result_dfs</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>

    <span class="nd">@azureml_service</span>
    <span class="k">def</span> <span class="nf">subtract_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_name</span><span class="p">,</span> <span class="n">b_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># (similar contents than `add_columns` here) </span>
        <span class="k">pass</span>
</code></pre></div>


<h3 id="using-it">Using it<a class="headerlink" href="#using-it" title="Permanent link">&para;</a></h3>
<p>Using your new client is extremely easy: simply instantiate it with a <code>ClientConfig</code> configuration object describing the AzureML services endpoints and you're set:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">azmlclient</span> <span class="kn">import</span> <span class="n">ClientConfig</span><span class="p">,</span> <span class="n">GlobalConfig</span><span class="p">,</span> <span class="n">ServiceConfig</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># create a configuration indicating the endpoints for each service id</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="p">(</span><span class="n">add_columns</span><span class="o">=</span><span class="n">ServiceConfig</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://.....&quot;</span><span class="p">,</span> 
                                             <span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;....&quot;</span><span class="p">),</span>
                   <span class="n">subtract_columns</span><span class="o">=</span><span class="n">ServiceConfig</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://.....&quot;</span><span class="p">,</span> 
                                                  <span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;....&quot;</span><span class="p">))</span>

<span class="c1"># instantiate the client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">MathsProvider</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

<span class="c1"># use it</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]})</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</code></pre></div>


<p>The configuration object can alternately be loaded from a <code>.yaml</code> file such as <a href="https://github.com/smarie/python-azureml-client/blob/master/azmlclient/tests/clients/dummy/ws_client/dummy_client_conf.yaml">this one</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cfg</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">yaml_file_path</span><span class="p">)</span>
</code></pre></div>


<p>or from a <code>configparser</code>-compliant <code>.ini</code>/<code>.cfg</code> file such as <a href="https://github.com/smarie/python-azureml-client/blob/master/azmlclient/tests/clients/dummy/ws_client/dummy_client_conf.cfg">this one</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cfg</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">cfg_file_path</span><span class="p">)</span>
</code></pre></div>


<p>Note that the service names in the configuration are by default the method names in your client class. If you wish to use different names, simply provide the service name to the <code>@azureml_service</code> decorator, for example:</p>
<div class="codehilite"><pre><span></span><code>    <span class="nd">@azureml_service</span><span class="p">(</span><span class="s1">&#39;subtract_columns&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">minus_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_name</span><span class="p">,</span> <span class="n">b_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="o">...</span>
</code></pre></div>


<h4 id="templating">Templating<a class="headerlink" href="#templating" title="Permanent link">&para;</a></h4>
<p>Finally, note that the yaml and ini/cfg configuration files can be templates, using the <a href="jinja.pocoo.org"><code>jinja2</code></a> syntax:</p>
<div class="codehilite"><pre><span></span><code><span class="na">(...)</span>

<span class="k">[add_columns]</span>
<span class="na">base_url</span> <span class="o">=</span> <span class="s">https://localhost:4443/a_plus_b</span>
<span class="na">api_key</span> <span class="o">=</span> <span class="s">{{ api_key }}</span>

<span class="na">(...)</span>
</code></pre></div>


<p>This way, you can for example specify api keys at configuration loading time without storing them in the configuration file. Simply provide the variables and their values as keyword arguments in any of the <code>load_config</code> or <code>load_yaml</code> function:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cfg</span> <span class="o">=</span> <span class="n">ClientConfig</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">cfg_file_path</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;abc25d4789e=o&quot;</span><span class="p">)</span>
</code></pre></div>


<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h3>
<p>If you wish to debug the calls made by your client, there are two things that you can do:</p>
<ul>
<li>(recommended) use a tool to capture network traffic such as <a href="https://www.telerik.com/fiddler">Fiddler</a> or (more complex) <a href="https://www.wireshark.org/">Wireshark</a>. Some tools such as Fiddler require you to change to http(s) proxy. This can be done by setting the <code>http(s)_proxy</code> configuration option as shown below. Note that this can also be done programatically by passing a <code>GlobalConfig(https_proxy=...,)</code> in the <code>ClientConfig</code> constructor.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="na">(client_cfg.ini)</span>

<span class="k">[global]</span>
<span class="c1"># (only for debug) use fiddler proxy and skip ssl verification</span>
<span class="c1"># http_proxy = ...</span>
<span class="na">https_proxy</span> <span class="o">=</span> <span class="s">http://localhost:8888</span>
<span class="na">ssl_verify</span> <span class="o">=</span> <span class="s">false</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>(client_cfg.yaml)

global:
   # (only for debug) use fiddler proxy and skip ssl verification 
   # http_proxy = ...
   https_proxy = http://localhost:8888
   ssl_verify: false
</code></pre></div>


<ul>
<li>alternatively you can use the <code>with client.debug_requests()</code> context manager on your client. This will print the http requests contents on stdout:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">debug_requests</span><span class="p">():</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</code></pre></div>


<h3 id="alternate-call-modes-local-batch">Alternate call modes: local, batch..<a class="headerlink" href="#alternate-call-modes-local-batch" title="Permanent link">&para;</a></h3>
<p>In the example above, <code>client.add_columns</code> calls the web service in request-response mode. This call mode can be changed temporarily thanks to the context managers provided:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># change to BATCH mode</span>
<span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">batch_calls</span><span class="p">(</span><span class="n">polling_period_seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="c1"># change to RR mode (useless since that&#39;s already the default)</span>
<span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">rr_calls</span><span class="p">():</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="c1"># change to LOCAL mode</span>
<span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">local_calls</span><span class="p">():</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</code></pre></div>


<p>For the local calls by default it does not work and yields:</p>
<div class="codehilite"><pre><span></span><code><span class="ne">NotImplementedError</span><span class="p">:</span> <span class="n">Local</span> <span class="n">execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">available</span> <span class="k">for</span> <span class="n">this</span> <span class="n">client</span><span class="o">.</span> 
<span class="n">Please</span> <span class="n">override</span> <span class="err">`</span><span class="n">__init_local_impl__</span><span class="err">`</span> <span class="ow">or</span> <span class="nb">set</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">none</span> <span class="err">`</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_impl</span><span class="err">`</span> 
<span class="k">if</span> <span class="n">you</span> <span class="n">wish</span> <span class="n">local</span> <span class="n">calls</span> <span class="n">to</span> <span class="n">be</span> <span class="n">made</span> <span class="n">available</span>
</code></pre></div>


<p>But if you override the <code>__init_local_impl__</code> method and return an object on which the methods are available, it works:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MathsProviderLocal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A local implementation of the same services</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">add_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_name</span><span class="p">,</span> <span class="n">b_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">a_name</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="n">b_name</span><span class="p">]})</span>

    <span class="k">def</span> <span class="nf">subtract_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_name</span><span class="p">,</span> <span class="n">b_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;diff&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">a_name</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">b_name</span><span class="p">]})</span>

<span class="k">class</span> <span class="nc">MathsProvider</span><span class="p">(</span><span class="n">AzureMLClient</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init_local_impl__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use our local implementation in &#39;local&#39; call mode&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MathsProviderLocal</span><span class="p">()</span>

    <span class="nd">@azureml_service</span>
    <span class="k">def</span> <span class="nf">add_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_name</span><span class="p">,</span> <span class="n">b_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@azureml_service</span>
    <span class="k">def</span> <span class="nf">subtract_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_name</span><span class="p">,</span> <span class="n">b_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="o">...</span>
</code></pre></div>


<p>we can test it :</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">local_calls</span><span class="p">():</span>
<span class="o">&gt;&gt;&gt;</span>    <span class="n">result_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span>

   <span class="nb">sum</span>
<span class="mi">0</span>    <span class="mi">1</span>
<span class="mi">1</span>    <span class="mi">7</span>
<span class="mi">2</span>   <span class="mi">13</span>
</code></pre></div>


<p>Note that the default call mode can also be changed permanentlyby specifying another mode in the <code>AzureMLClient</code> constructor arguments, or by changing the <code>client._current_call_mode</code> attribute.</p>
<h2 id="3-payload-conversion-goodies">3. Payload conversion goodies<a class="headerlink" href="#3-payload-conversion-goodies" title="Permanent link">&para;</a></h2>
<p>You can use the static methods available on the classes to convert data between json and python easily.</p>
<h3 id="from-json-to-python">From json to python<a class="headerlink" href="#from-json-to-python" title="Permanent link">&para;</a></h3>
<p>You can convert the body from the HTTP web service calls into python objects using <code>RequestResponseClient</code> static methods:</p>
<ul>
<li>for RR requests using <code>RequestResponseClient.decode_request_json_body(body)</code></li>
<li>for RR responses using <code>RequestResponseClient.read_response_json_body(body)</code></li>
</ul>
<p>For example for requests:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">azmlclient</span> <span class="kn">import</span> <span class="n">RequestResponseClient</span>

<span class="c1"># -- read from file</span>
<span class="c1"># with open(&#39;./request_payload.json&#39;) as f:</span>
<span class="c1">#     request_payload = f.read()</span>

<span class="c1"># -- read from variable</span>
<span class="n">request_payload</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">{</span>
<span class="s2">&quot;GlobalParameters&quot;: {&quot;p1&quot;: &quot;p1_val&quot;, &quot;p2&quot;: &quot;p2_val&quot;}, </span>
<span class="s2">&quot;Inputs&quot;: {</span>
<span class="s2">      &quot;trainDataset&quot;: {</span>
<span class="s2">         &quot;ColumnNames&quot;: [&quot;a&quot;, &quot;b&quot;], </span>
<span class="s2">         &quot;Values&quot;: [[0, 0], [1, 1], [2, 999]]}</span>
<span class="s2">   }</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># parse the payload from a web service request to create the python equivalents</span>
<span class="n">dfs</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">RequestResponseClient</span><span class="o">.</span><span class="n">decode_request_json_body</span><span class="p">(</span><span class="n">request_payload</span><span class="p">)</span>

<span class="c1"># display results:</span>
<span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input </span><span class="si">%r</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="n">input_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Parameters:</span>
<span class="s2">{</span>
<span class="s2">   </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</code></pre></div>


<p>yields:</p>
<div class="codehilite"><pre><span></span><code>Input <span class="s1">&#39;trainDataset&#39;</span>:
   a    b
<span class="m">0</span>  <span class="m">0</span>    <span class="m">0</span>
<span class="m">1</span>  <span class="m">1</span>    <span class="m">1</span>
<span class="m">2</span>  <span class="m">2</span>  <span class="m">999</span>


Parameters:
<span class="o">{</span>
   <span class="s1">&#39;p1&#39;</span>: <span class="s1">&#39;p1_val&#39;</span>
   <span class="s1">&#39;p2&#39;</span>: <span class="s1">&#39;p2_val&#39;</span>
<span class="o">}</span>
</code></pre></div>


<h3 id="from-python-to-json">From python to json<a class="headerlink" href="#from-python-to-json" title="Permanent link">&para;</a></h3>
<p>You can create json requests and even fake responses from a <code>RequestResponseClient</code> instance:</p>
<ul>
<li>the json request body using <code>rr_client.create_request_body(dfs, params)</code></li>
<li>the json response body using <code>rr_client.create_response_body(dfs)</code></li>
</ul>
<p>For example for the request:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">azmlclient</span> <span class="kn">import</span> <span class="n">RequestResponseClient</span>

<span class="c1"># some dataframe</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                              <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
<span class="c1"># give it a name</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trainDataset&#39;</span><span class="p">:</span> <span class="n">train_df</span><span class="p">}</span>

<span class="c1"># parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="c1"># convert to json payload and print</span>
<span class="n">json_payload</span> <span class="o">=</span> <span class="n">RequestResponseClient</span><span class="p">()</span><span class="o">.</span><span class="n">create_request_body</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json_payload</span><span class="p">)</span>
</code></pre></div>


<p>yields:</p>
<div class="codehilite"><pre><span></span><code><span class="o">{</span><span class="s2">&quot;Inputs&quot;</span>: <span class="o">{</span><span class="s2">&quot;trainDataset&quot;</span>: <span class="o">{</span><span class="s2">&quot;ColumnNames&quot;</span>: <span class="o">[</span><span class="s2">&quot;a&quot;</span>, <span class="s2">&quot;b&quot;</span><span class="o">]</span>, <span class="s2">&quot;Values&quot;</span>: <span class="o">[[</span><span class="m">0</span>, <span class="m">1</span><span class="o">]</span>, <span class="o">[</span><span class="m">1</span>, <span class="m">2</span><span class="o">]</span>, <span class="o">[</span><span class="m">2</span>, <span class="m">3</span><span class="o">]]}}</span>, <span class="s2">&quot;GlobalParameters&quot;</span>: <span class="o">{</span><span class="s2">&quot;bar&quot;</span>: <span class="m">2</span>, <span class="s2">&quot;foo&quot;</span>: <span class="m">1</span><span class="o">}}</span>
</code></pre></div>


<h2 id="main-features">Main features<a class="headerlink" href="#main-features" title="Permanent link">&para;</a></h2>
<ul>
<li>Creates the Web Services requests from dataframe inputs and dataframe/dictionary parameters, and maps the responses to dataframes too</li>
<li>Maps the errors to more friendly python exceptions</li>
<li>Supports both Request/Response and Batch mode</li>
<li>In Batch mode, performs all the Blob storage and retrieval for you.</li>
<li>Properly handles file encoding in both modes (<code>utf-8</code> is used by default as the pivot encoding)</li>
<li>Supports global <code>requests.Session</code> configuration to configure the HTTP clients behaviour (including the underlying blob storage client).</li>
<li>Provides tools to create higher-level clients supporting both remote and local call modes. </li>
</ul>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li>The official <a href="https://github.com/Azure/Azure-MachineLearning-ClientLibrary-Python#services-usage">AzureML client library</a></li>
</ul>
<h3 id="others">Others<a class="headerlink" href="#others" title="Permanent link">&para;</a></h3>
<p><em>Do you like this library ? You might also like <a href="https://github.com/smarie/OVERVIEW#python">my other python libraries</a></em> </p>
<h2 id="want-to-contribute">Want to contribute ?<a class="headerlink" href="#want-to-contribute" title="Permanent link">&para;</a></h2>
<p>Details on the github page: <a href="https://github.com/smarie/python-azureml-client">https://github.com/smarie/python-azureml-client</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
        
          <a href="changelog/" title="Changelog" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Changelog
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"search.result.other": "# matching documents", "search.result.one": "1 matching document", "search.config.separator": "[\\s\\-]+", "search.config.lang": "en", "search.result.none": "No matching documents", "clipboard.copy": "Copy to clipboard", "search.config.pipeline": "trimmer, stopWordFilter", "search.result.placeholder": "Type to start searching", "clipboard.copied": "Copied to clipboard"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>